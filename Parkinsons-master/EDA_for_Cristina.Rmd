---
title: "EDA Plots for Parkinson's Project"
output: pdf_document
---

```{r setup, include=FALSE,echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load("ggplot2","knitr","arm","foreign","car","Cairo","data.table","readxl","dplyr","tidyverse","kableExtra","maps","plotly","esquisse","gridExtra","viridis", update=FALSE)
```

```{r, warning=FALSE,echo=FALSE}
library(readr)
names.files<-dir(pattern = "EE") #find file named starting with EE

l.names.files <- length(names.files) #we have 100 csv.files in total
l.press.names.files <- 55 #there are 55 press exercise files
l.bike.names.files <- l.names.files - l.press.names.files #and 45 bike files

# merge press data
merge.press <- NULL
for (i in 1:l.press.names.files) {
  merge <- read_csv(file = names.files[i], col_types = list(col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double()))
  merge.press <- rbind(merge.press, merge)
}
merge.press[merge.press$Effort==0.5,] <-0.6

#merge bike data
merge.bike<-NULL
for (j in (l.press.names.files + 1) : l.names.files) {
  merge <- read_csv(file = names.files[j], col_types = list(col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double(), col_double()))
  merge.bike <- rbind(merge.bike, merge)
}
merge.bike[merge.bike$Effort==0.5,] <-0.6

# change the name of variables in bike data besides of "subject" to avoid repeat column names while merging two datasets
names(merge.bike) <- c("subject", "effortDelay_bike", "run_bike", "runStart_bike", "trial_bike", "CueAll_Onset_bike", "CueAll_Offset_bike", "response_bike", "Reward_bike", "Effort_bike", "Order_bike", "RT_bike", "Trigger_bike", "ITI_Onset_Bike", "ITI_Offset_bike", "CounterBalance_Order_bike")

# creat a new variable named "identify" with "subject" and "trail"
merge.bike$identify <- paste(merge.bike$subject, merge.bike$trial_bike)
merge.press$identify <- paste(merge.press$subject, merge.press$trial)


# combine two datasets using the unique variable "identify", each subject has 36 rows with both press and bike data
merge <- NULL
merge <- merge(x = merge.press, y = merge.bike, by = "identify", all = TRUE)

# find rows including NA value
list <- which(rowSums(is.na(merge)) > 0)
# creat a subset only including rows with NA value
submerge.na <- merge[list, ]

#and identify those subjects
na.bike <- unique(submerge.na$subject.x)

# We found that we don't have the bike data of the following subject:117,118,119,120,121,123,124,136,202,211. 

# create a subset and delete useless variables
submerge <- merge

submerge$identify <- NULL
submerge$effortDelay <- NULL
submerge$run <- NULL
submerge$Trigger <- NULL
submerge$effortDelay_bike <- NULL
submerge$run_bike <- NULL
submerge$Trigger_bike <- NULL
submerge$subject.y <- NULL

# What is runStart, CueAll_Onset, CueAll_Offset, Order, RT, ITI_Onset, ITI_Offset and CounterBalance_Order? useful or not? should we delete them?

# create another subset without NA value. It will be useful when analysing the relationship between bike group and button group.
submerge.withoutna <- merge[-list,] 

# keep variables: subject, trails, response, reward, effort. So select these varibles from "submerge" and named it by "cleaned_merge"
submerge %>%
  select(subject.x, trial, response, Reward, Effort, response_bike, Reward_bike, Effort_bike) -> cleaned_merge

#release submerge
submerge <-NULL
colnames(cleaned_merge)[1] <-"subject"

# Merge datasets - clinical
clinical <- read_excel("E4EPD Dataset 101018.xlsx")
clinical$PD <- factor(clinical$PD)
colnames(clinical)[3] <- "subject"
#merged clinical data and trails data
merge_c_t <- merge(cleaned_merge, clinical, by="subject")

# Merge datasets - DiscountingParameters
DiscountingParameters_press <- read_excel("DiscountingParameters.xlsx",sheet="Button Choice")
DiscountingParameters_bike <- read_excel("DiscountingParameters.xlsx",sheet="Bike Choice")
DiscountingParameters_press$ID <- NULL
DiscountingParameters_bike$ID <- NULL
colnames(DiscountingParameters_bike) <- c("subject","K.bike","Temperature.bike","P.bike","best fit.bike")
colnames(DiscountingParameters_press)[1] <- "subject"
# merged discounting parameters data
merge_c_t_d <- merge(merge_c_t, DiscountingParameters_press , by = "subject")
merge_c_t_d <- merge(merge_c_t_d, DiscountingParameters_bike , by = "subject")

merge_c_t_d %>%
  select(PD,response) %>%
  filter(PD == 1) %>%
  count(response)  -> PD_response_button
colnames(PD_response_button)[2] <- "count_PD_response_button"
PD_response_button$button_percent <- PD_response_button$count_PD_response_button/sum(PD_response_button$count_PD_response_button)

merge_c_t_d %>%
  select(PD,response_bike) %>%
  filter(PD == 1) %>%
  count(response_bike)  -> PD_response_bike
colnames(PD_response_bike) <- c("response","count_PD_response_bike")
PD_response_bike$bike_percent <-  PD_response_bike$count_PD_response_bike/sum(PD_response_bike$count_PD_response_bike)

PD_response <- merge(PD_response_button,PD_response_bike,by = "response")
PD_response$response <- c("No","Yes","No response")

merge_c_t_d %>%
  select(PD,response) %>%
  filter(PD == 0) %>%
  count(response)  -> HC_response_button
colnames(HC_response_button)[2] <- "count_HC_response_button"
HC_response_button$button_percent <- HC_response_button$count_HC_response_button/sum(HC_response_button$count_HC_response_button)

merge_c_t_d %>%
  select(PD,response_bike) %>%
  filter(PD == 0) %>%
  count(response_bike)  -> HC_response_bike
HC_response_bike <- na.omit(HC_response_bike)
colnames(HC_response_bike) <- c("response","count_HC_response_bike")
HC_response_bike$bike_percent <- HC_response_bike$count_HC_response_bike/sum(HC_response_bike$count_HC_response_bike)

HC_response <- merge(HC_response_button,HC_response_bike,by = "response")
HC_response$response <- c("No","Yes","No response")

HC_response_p <- HC_response[,c(1,3,5)]
HC_response_p$PD <- 0

PD_response_p <- PD_response[,c(1,3,5)]
PD_response_p$PD <- 1

HC_PD_response <- rbind(HC_response_p,PD_response_p)
```

Date: October 30, 2018

Included below are several initial plots that reflect key trends or differences we see in the data. Please note this is an initial pass at the data and further exploration will be conducted as we continue the project.

***

## Comparison of Apathy Scores for Healthy Controls vs. Parkinson's Disease

In Figure 1, no dramatic difference between HC and PD study participants.

In Figure 2, apparent difference between HC and PD study participants.

```{r,echo=FALSE}
#Figure 1
ggplot(clinical, aes(PD, Apathy_scale)) + geom_boxplot(aes(fill=factor(PD))) +
  labs(title="Figure 1: SAS Apathy Scores",
       x="",
       y="Apathy Score") + scale_x_discrete(labels = c("Healthy Control", "Parkinson's Disease")) + theme(legend.position="none")

#Figure 2
ggplot(clinical, aes(PD, LARS_total)) + geom_boxplot(aes(fill=factor(PD))) +
  labs(title="Figure 2: LARS Apathy Scores",
       x="",
       y="Apathy Score") + scale_x_discrete(labels = c("Healthy Control", "Parkinson's Disease")) + theme(legend.position="none")

```

## Comparison of Depression Scores for Parkinson's vs. Healthy Controls

In Figure 3, apparent difference between HC and PD study participants.

```{r,echo=FALSE}
#Figure 3
ggplot(clinical, aes(PD, GDS)) + geom_boxplot(aes(fill=factor(PD))) +
  labs(title="Figure 3: Geriatric Depression Scores",
       x="",
       y="Depression Score") + scale_x_discrete(labels = c("Healthy Control", "Parkinson's Disease")) + theme(legend.position="none")

t.test(clinical$GDS~clinical$PD)
```

## Comparison of Responses by Parkinson's Disease vs. Healthy Controls
## (Focusing on response by effort level)

In Figure 4, negative relation between effort level and response. 

In Figure 5, similar relation between effort level and response, but no apparent relationship between severity and response.

```{r,echo=FALSE,warning=FALSE}
merge_c_t_d %>%
  filter(PD == 1) -> PD_data
merge_c_t_d %>%
  filter(PD == 0) -> HC_data

# Figure 4
merge_c_t_d[is.na(merge_c_t_d)] <- 0 
ggplot(merge_c_t_d, aes(x = Effort, y = response, response_bike, colour = UPDRS, alpha = 0.01)) + geom_point() + 
  set.seed(5) +
  geom_jitter(position=position_jitter()) +  
  ggtitle("Figure 4: How does response differ by disease severity?") + 
  xlab("Effort level") + 
  ylab("") +
  geom_smooth(method = 'gam') +
  scale_y_continuous(breaks=c(0, 1, 2), labels = c("No", "Yes", "No Answer")) +
  scale_color_gradient(low="lightblue", high="darkblue",limit = range(c(0,70)))

# Figure 5
ggplot(PD_data, aes(x = Effort, y = response, response_bike, colour = UPDRS)) +
  geom_point() + 
  set.seed(5) +
  geom_jitter(position=position_jitter()) +  
  ggtitle("Figure 5: What if we look at only Parkinson's patients?") + 
  xlab("Effort level") + 
  ylab("")  +
  geom_smooth(method = 'gam') +
  scale_y_continuous(breaks=c(0, 1, 2), labels = c("No", "Yes", "No Answer")) +
  scale_color_gradient(low="lightblue", high="darkblue", limit = range(c(0,70)))

```

## Comparison of Responses by Parkinson's Disease vs. Heatlhy Controls
## (Focusing on response by ratio of effort to reward)

In Figure 6, similar trend of relationship between response and effort/reward of PD&HC. 

In Figure 7, negative relation between ratio of effort/reward and response.

```{r,echo=FALSE}
merge_c_t_d %>%
  filter(PD == 1) -> PD_data
merge_c_t_d %>%
  filter(PD == 0) -> HC_data

# Figure 6
merge_c_t_d[is.na(merge_c_t_d)] <- 0 
ggplot(merge_c_t_d, aes(x = Effort/Reward, y = response, response_bike, colour = factor(PD),alpha = 0.01)) +
  geom_point() + 
  set.seed(5) +
  geom_jitter(position=position_jitter()) +  
  ggtitle("Figure 6: How does response differ by PD and HC?") + 
  xlab("Ratio of Effort/Reward") + 
  ylab("") + 
  labs( subtitle = '' , alpha = "Transparency", colour = c("HC=0,PD=1")) +
  geom_smooth(method = 'gam') +
  scale_y_continuous(breaks=c(0, 1, 2), labels = c("No", "Yes", "No Answer"))

# Figure 7
ggplot(PD_data, aes(x = Effort/Reward, y = response, response_bike, colour = UPDRS)) +
  geom_point() + 
  set.seed(5) +
  geom_jitter(position=position_jitter()) +  
  ggtitle("Figure 7: How does response differ by disease severity?") + 
  xlab("Ratio of Effort/Reward") + 
  ylab("")  +
  geom_smooth(method = 'gam') +
  scale_y_continuous(breaks=c(0, 1, 2), labels = c("No", "Yes", "No Answer")) +
  scale_color_gradient(low="lightblue", high="darkblue")

```

## Comparison of Results Between Biking and Pressing Exercises

In Figure 8, more 'Yes' than 'No' response on pressing exercise.

In Figure 9, more 'Yes' of PD than HC on pressing exercise.

In Figure 10, more 'Yes' than 'No' response on biking exercise.

In Figure 11, same response proportion of PD than HC on biking exercise.

```{r,echo=FALSE,warning=FALSE}

# Figure 8
ggplot(data = merge_c_t) +
  aes(fill = factor(PD), x = response) +
  geom_bar(position = "dodge") +
  labs(title = 'Figure 8: What is the distribution of responses for pressing exercise?',
    x = 'Response') +
  scale_x_continuous(breaks=c(0, 1, 2), labels = c("No", "Yes", "No Answer")) + 
  scale_fill_discrete(name ="", labels=c("Healthy Control", "Parkinson's Disease"))

# Figure 9
ggplot(data = HC_PD_response) +
  aes(fill = factor(PD), x = response,y = button_percent) +
  geom_bar(stat = "identity",position="dodge") +
  labs(title = 'Figure 9: What is the proportion of responses for pressing exercise?',
    x = 'Response', 
    y = 'Response proportion') +
  theme_minimal()+ 
  scale_fill_discrete(name ="", labels=c("Healthy Control", "Parkinson's Disease"))

# Figure 10
ggplot(data = merge_c_t) +
  aes(fill = factor(PD), x = response_bike) +
  geom_bar(position = "dodge") +
  labs(title = 'Figure 10: What is the distribution of responses for biking exercise?',
    x = 'Response',
    y = 'Response in total') +
  scale_x_continuous(breaks=c(0, 1, 2), labels = c("No", "Yes", "No Answer")) +
  scale_fill_discrete(name ="", labels=c("Healthy Control", "Parkinson's Disease"))

# Figure 11
ggplot(data = HC_PD_response) +
  aes(fill = factor(PD), x = response,y = bike_percent) +
  geom_bar(stat = "identity",position="dodge") +
  labs(title = 'Figure 11: What is the proportion of responses for biking exercise?',
    x = 'Response', 
    y = 'Response proportion') +
  theme_minimal()+ 
  scale_fill_discrete(name ="", labels=c("Healthy Control", "Parkinson's Disease"))
```

# Exploring K and P values for study participants

These are calculated based on outside research on effort-based discounting models that allow for modeling at individual level. K and P values were computed for each participant in the study aggregated across all trials/questions.

In Figure 12, exploration is needed for study participants with zero k values.

In Figure 13, right skewed distribution with cluster of participants at p=10.

```{r,echo=FALSE}

# Figure 12
ggplot(data = DiscountingParameters_press) +
  aes(x = K) +
  geom_histogram(bins = 30, fill = '#0c4c8a') +
  labs(title = 'Figure 12: Distribution of K (Discount factor) for Pressing',
    x = 'K values (discount factor)',
    y = 'Frequency') +
  theme_minimal()

# Figure 13
ggplot(data = DiscountingParameters_press) +
  aes(x = p) +
  geom_histogram(bins = 30, fill = '#0c4c8a') +
  labs(title = 'Figure 13: Distribution of P values for Pressing',
    x = 'P values (discount curve parameter)',
    y = 'Frequency',
    subtitle = ("")) +
  theme_minimal()

```

In Figure 14, exploration is needed for study participants with zero k values.

In Figure 15, right skewed distribution with cluster of participants at p=10.

```{r,echo=FALSE}

# Figure 14
ggplot(data = DiscountingParameters_bike) +
  aes(x = K.bike) +
  geom_histogram(bins = 30, fill = '#0c4c8a') +
  labs(title = 'Figure 14: Distribution of K (Discount factor) for Biking',
    x = 'K values (discount factor)',
    y = 'Frequency') +
  theme_minimal()

# Figure 15
ggplot(data = DiscountingParameters_bike) +
  aes(x = P.bike) +
  geom_histogram(bins = 30, fill = '#0c4c8a') +
  labs(title = 'Figure 15: Distribution of P values for Biking',
    x = 'P values (discount curve parameter)',
    y = 'Frequency',
    subtitle = ("")) +
  theme_minimal()

```

## Comparison by Healthy Controls vs. Parkinson's Disease

Pressing

In Figure 16, apparent difference between HC and PD study participants in discount factor.

In Figure 17, apparent difference between HC and PD study participants with p values.

```{r,echo=FALSE,warning=FALSE}

# Figure 16
ggplot(merge_c_t_d, aes(PD, K)) + geom_boxplot(aes(fill=factor(PD))) +
  labs(title="Figure 16: K values (Discount factor) for pressing exercise",
       x="",
       y="K value") + scale_x_discrete(labels = c("Healthy Control", "Parkinson's Disease")) + theme(legend.position="none")

# Figure 17
ggplot(merge_c_t_d, aes(PD, p)) + geom_boxplot(aes(fill=factor(PD))) +
  labs(title="Figure 17: P values (affects shape of discount curve) for pressing exercise", 
       x="",
       y="p value") + scale_x_discrete(labels = c("Healthy Control", "Parkinson's Disease")) + theme(legend.position="none")
```

Biking

In Figure 18, a large difference is not apparent.

In Figure 19, a small difference in apparent.

```{r,echo=FALSE,warning=FALSE}

# Figure 18
ggplot(merge_c_t_d, aes(PD, K.bike)) + geom_boxplot(aes(fill=factor(PD))) +
  labs(title="Figure 18: K values (Discount factor) for biking exercise",
       x="",
       y="K value") + scale_x_discrete(labels = c("Healthy Control", "Parkinson's Disease")) + theme(legend.position="none")

# Figure 19
ggplot(merge_c_t_d, aes(PD, P.bike)) + geom_boxplot(aes(fill=factor(PD))) +
  labs(title="Figure 19: P values (affects shape of discount curve) for biking exercise", 
       x="",
       y="p value") + scale_x_discrete(labels = c("Healthy Control", "Parkinson's Disease")) + theme(legend.position="none")
```

